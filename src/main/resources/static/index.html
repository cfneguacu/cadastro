<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="ISO-8859-1">
	<!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.10/jquery.mask.min.js">
<title>Controle de Cadastros</title>
<style type ="text/css">
html {
	margin-left: 5%;
	margin-right: 5%;
	margin-top: 5%;
}
</style>
</head>
<body>
<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="profile" aria-selected="false">Inicio</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="true">Cadastro</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab" aria-controls="contact" aria-selected="false">Pesquisa</button>
  </li>
</ul>
<div class="tab-content" id="myTabContent" >
  <div class="tab-pane fade" id="home" role="tabpanel" aria-labelledby="home-tab">...</div>
  <div class="tab-pane fade show active" id="profile" role="tabpanel" aria-labelledby="profile-tab">
	<br>
	<form class="row g-3" id="formCadastro">
	<h3>Dados Pessoais</h3>
	<hr style="height:2px;border-width:0;color:gray;background-color:blue">
    <div class="col-md-6" style ="width: 650px;">
    <label for="inputEmail4" class="form-label">ID</label>
    <input type="text" class="form-control" id="codigo" style="width: 46px; "><label for="inputAddress" class="form-label">Nome </label><input type="text" class="form-control" id="nome"  style="width: 382px; ">
  	<label for="inputAddress" class="form-label">Data Nascimento </label>
  	<div class="input-group date" data-provide="datepicker" style="width: 184px;">
    <input type="date" class="form-control" id="datanasc">
  	  	<div class="input-group-addon">
        <span class="glyphicon glyphicon-th"></span>
    	</div>
	</div>
  	 <label for="inputAddress" class="form-label">Idade</label><input type="text" class="form-control" id="idade"  style="width: 115px; " onfocus="calculaIdade()">
    </div>
     <br>
     <h3>Endereço</h3>
     <hr style="height:2px;border-width:0;color:gray;background-color:blue">
     <div class="col-md-6" style ="width: 650px;">
     <label for="inputAddress" class="form-label">Endereço </label><input type="text" class="form-control" id="endereco"  style="width: 300px; ">
     <label for="inputAddress2" class="form-label">Nº </label><input type="text" class="form-control" id="numero" style="width: 47px; ">
     <label for="inputAddress2" class="form-label">Bairro </label> <input type="text" class="form-control" id="bairro"  style="width: 300px; ">
     <label for="inputAddress2" class="form-label">CEP </label><input type="text" class="form-control" id="cep" style="width: 92px; " onkeypress="mascara(this, '#####-###')" maxlength="9"><label for="inputAddress2" class="form-label">Cidade </label><input type="text" class="form-control" id="cidade" style="width: 92px; "><label for="inputAddress2" class="form-label">UF </label><input type="text" class="form-control" id="estado" style="width: 92px; ">
     </div>
      <div class="col-md-6">
      <label for="inputAddress" class="form-label">Telefone1</label><input type="text" class="form-control" id="telefone1"  style="width: 325px; " onkeypress="mascara(this, '## #####-####')" maxlength="13">
      <label for="inputAddress" class="form-label">Telefone2</label><input type="text" class="form-control" id="telefone2"  style="width: 325px; " onkeypress="mascara(this, '## #####-####')" maxlength="13">
 	  </div>
 	  <br>
 	  <h3>Outros</h3> 
 	  <hr style="height:2px;border-width:0;color:gray;background-color:blue">
    <div>
  	 	<label for="inputAddress" class="form-label">Estuda </label><div class="form-check">
  		<input class="form-check-input" type="radio" name="estuda" id="estudasim" value="true">
  		<label class="form-check-label" for="flexRadioDefault1">Sim </label>
   </div>
<div class="form-check">
  <input class="form-check-input" type="radio" name="estuda" id="estudanao" value="false">
  <label class="form-check-label" for="flexRadioDefault2">
Não  </label>
</div>
 	  <label for="inputAddress" class="form-label">Quantos moram na casa?</label><input type="text" class="form-control" id="quantosmoram"  style="width: 325px; ">
 	  <label for="inputAddress" class="form-label">Casa Propria?</label>
 	  <div class="form-check">
  <input class="form-check-input" type="radio" name="casapropria" id="casaprorpiasim" value="true">
  <label class="form-check-label" for="flexRadioDefault1">
    Sim
  </label>
</div>
<div class="form-check">
  <input class="form-check-input" type="radio" name="casapropria" id="casaprorpianao" value="false">
  <label class="form-check-label" for="flexRadioDefault2">
Não  </label>
</div>
<div>
<label for="inputAddress" class="form-label">Numero NIS </label><input type="text" class="form-control" id="numeronis" style="width: 325px; ">
</div>
  </div>
	</form>
	<div class="col-md-6" style="width : 700px;">
	<button type="button" class="btn btn-primary" onclick="salvarUsuario()">Salvar</button>
	<button type="button" class="btn btn-secondary" onclick="document.getElementById('formCadastro').reset();">Novo</button>
	<!--button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#modalPesquisarCadastro">Pesquisar</button-->
	<button type="button" class="btn btn-warning" onclick="botaoDeletarDaTela();">Deletar</button>
  </div>
	</div>
  <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
  <div id="modalPesquisar" tabindex="-1" aria-labelledby="exampleModalLabel">
  <div>
    <div>
      <div>
        <br>
        <h3 id="exampleModalLabel">Pesquisa</h3>
        <hr style="height:2px;border-width:0;color:gray;background-color:blue">
      </div>
      <div>
        <form>
          <div>
            <label for="nomeBusca" class="col-form-label">Informe o Nome:</label>
            <input type="text" class="form-control" id="nomeBusca">
          </div>
          <button type="button" class="btn btn-success" onclick="pesquisarCadastro()">Buscar</button>
          <button type="button" class="btn btn-secondary" onclick="listarCadastros()">Gerar Relatorio</button>
          <label id ="registrosencontrados">Registros Encontrados: </label>
        </form>
        
        <div style ="height: 1100px;">
 <table class="table" id="tabelaresultados">
  <thead>
    <tr>
    <th scope="col">ID</th>
    <th scope="col">Nome</th>
    <th scope="col">Data Nasc</th>
    <th scope="col"> Idade </th>
	<th scope="col"> Endereço</th>
	<th scope="col"> Número</th>
	<th scope="col"> Bairro</th>
	<th scope="col"> CEP</th>
	<th scope="col"> Cidade</th>
	<th scope="col"> Tel Principal</th>
    <th scope="col">Editar</th>
    <th scope="col">Delete</th>
    <th scope ="col">Imprimir/PDF</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
      </div>
      </div>
    </div>
  </div>
</div>
  </div>
</div>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    <script type = "text/javascript">
		
    	
     function listarCadastros(){
    	 
    	 nome = $('#nomeBusca').val();
     	  
     	  //if(nome != null && nome.trim()!= ''){
     		  
     		  $.ajax({
     	    		method: "GET",
     	    		url: "cadastrobuscarPorNome",
     	    		data : "name=" + nome ,
     	    		success: function(response){
     	    			var style = "<style>";
     	    	        style = style + "table {width:100%;font: 8px Calibri;}";
     	    	        style = style + "table, tr, th, td {border: solid 1px #DDD; border-collapse: collapse;";
     	    	        style = style + "padding: 2px 3px;text-align: center;}";
     	    	        style = style + "</style>";
     	    			var win = window.open('', '', 'height=700,width=700');
 	    		        win.document.write('<html><head>');
 	    		        win.document.write('<title>Cadastro</title>');   // <title> CABEÇALHO DO PDF.                                   // INCLUI UM ESTILO NA TAB HEAD
 	    		        win.document.write('</head>');
 	    		        win.document.write('<body>');
 	    		 		win.document.write(style);
 	    		        win.document.write('<table id="tabelalista">');
 	    		        win.document.write(' <thead>'+
    										'<tr>'+
    										'<th scope="col">ID</th>'+
    										'<th scope="col">Nome</th>'+
   										    '<th scope="col">Data Nasc</th>'+
    										'<th scope="col"> Idade </th>'+
											'<th scope="col"> Endereço</th>'+
											'<th scope="col"> Número</th>'+
											'<th scope="col"> Bairro</th>'+
											'<th scope="col"> CEP</th>'+
											'<th scope="col"> Cidade</th>'+
											'<th scope="col"> Tel 1</th>'+
    										'<th scope="col"> Tel 2r</th>'+
    										'<th scope="col">Quantos Moram</th>'+
    										'<th scope ="col">Estuda</th>'+
    										'<th scope ="col">Casa Propria</th>'+
    										'<th scope ="col">Numero Nis</th>'+
    										'</tr>'+
  											'</thead>');
 	    		        win.document.write('<tbody>');
     	    			//win.document.write($('#tabelalista > tbody > tr').remove());
     	    			for (var i = 0; i < response.length; i++){
     	    				var estuda;
     	    				if((response[i].estuda) == true){
     	    					estuda = 'sim';
     	    				}else{
     	    					estuda = 'não';
     	    				}
     	    				var casapropria;
     	    				if((response[i].casapropria)== true){
     	    					casapropria = 'sim';
     	    				}else{
     	    					casapropria = 'não';
     	    				}
     	    				
     	    				win.document.write('<tr id="'+response[i].codigo+'"><td>'+response[i].codigo+'</td>'+
         	   						'<td>'+response[i].nome+'</td><td>'+response[i].datanasc+'</td><td>'+response[i].idade+'</td>'+
         	   						'<td>'+response[i].endereco+'</td><td>'+response[i].numero+'</td><td>'+response[i].bairro+'</td>'+
         	   						'<td>'+response[i].cep+'</td><td>'+response[i].cidade+'</td><td>'+response[i].telefone1+'</td></td>'+
         	   						'<td>'+response[i].telefone2+'</td><td>'+response[i].quantosmoram+'</td><td>'+estuda+'</td>'+
         	   						'<td>'+casapropria+'</td><td>'+response[i].numeronis+'</td></tr>');     	    			
     	    			}
 	    		        win.document.write('</tbody');
     		 			win.document.write('</body>');
						win.document.write('</html>');
						win.document.close(); 	                                         // FECHA A JANELA
		       			win.print(); 
  	    			}
  	    	}).fail(function(xhr,status,errorThrown){
  	    		alert("Erro ao buscar usuario:" + xhr.responseText);
  	    	}); 
  	//  } 
  }
    
    function CriaPDF(codigo) {
    	
    	$.ajax({
    		method: "GET",
    		url: "cadastrobuscaruserId",
    		data : "iduser=" + codigo,
    		success: function(response){
    		$("#codigo").val(response.codigo);
			$("#nome").val(response.nome);
   			$("#datanasc").val(response.datanasc);
   			$("#idade").val(response.idade);
			$("#endereco").val(response.endereco);
			$("#numero").val(response.numero);
			$("#bairro").val(response.bairro);
			$("#cep").val(response.cep);
			$("#cidade").val(response.cidade);
			$("#estado").val(response.estado);
			$("#telefone1").val(response.telefone1);
			$("#telefone2").val(response.telefone2);
			//$(".estuda:checked").val(response.estuda);
			$("#quantosmoram").val(response.quantosmoram);
			//$(".casapropria:checked").val(response.casapropria);
			$("#numeronis").val(response.numeronis);
			
			var minhaTabela = document.getElementById('formCadastro').innerHTML;
	        // CRIA UM OBJETO WINDOW
	        var win = window.open('', '', 'height=700,width=700');
	        win.document.write('<html><head>');
	        win.document.write('<title>Cadastro</title>');   // <title> CABEÇALHO DO PDF.                                   // INCLUI UM ESTILO NA TAB HEAD
	        win.document.write('</head>');
	        win.document.write('<body>');
	        win.document.write('<h3>Dados Pessoais</h3>');
	        win.document.write(' <label for="inputEmail4" class="form-label">ID: </label>')
	        win.document.write(response.codigo);
	        win.document.write(' <label for="inputEmail4" class="form-label">Nome: </label>')
	        win.document.write(response.nome);
	        win.document.write('<br><label for="inputEmail4" class="form-label">Data Nascimento: </label>')
	        win.document.write(response.datanasc);
	        win.document.write('<label for="inputEmail4" class="form-label">Idade: </label>')
	        win.document.write(response.idade);
	        win.document.write('<br>')
	        win.document.write('<h3>Endereço</h3>')
	        win.document.write(' <label for="inputEmail4" class="form-label">Endereço: </label>')
	        win.document.write(response.endereco);
	        win.document.write(' <label for="inputEmail4" class="form-label">Número: </label>')
	        win.document.write(response.numero);
	        win.document.write(' <label for="inputEmail4" class="form-label">Bairro: </label>')
	        win.document.write(response.bairro);
	        win.document.write(' <label for="inputEmail4" class="form-label">CEP: </label>')
	        win.document.write(response.cep);
	        win.document.write(' <label for="inputEmail4" class="form-label">Cidade: </label>')
	        win.document.write(response.cidade);
	        win.document.write('<br><label for="inputEmail4" class="form-label">Estado: </label>')
	        win.document.write(response.estado);
	        win.document.write('<br><label for="inputEmail4" class="form-label">Telefone 1: </label>')
	        win.document.write(response.telefone1);
	        win.document.write(' <label for="inputEmail4" class="form-label">Telefone 2: </label>')
	        win.document.write(response.telefone2);
	        win.document.write('<br>')
	        win.document.write('<h3>Outros</h3>')
	       	win.document.write(' <label for="inputEmail4" class="form-label">estuda: </label>')
	       	if (response.estuda == false){
	       	win.document.write('Não');	
	       	}else{
	       	win.document.write('Sim');
	       	}
	        win.document.write(' <label for="inputEmail4" class="form-label">Quantos Moram: </label>')
	        win.document.write(response.quantosmoram);
	    	win.document.write(' <label for="inputEmail4" class="form-label">Casa Propria: </label>')
	       	if (response.casapropria == false){
	       	win.document.write('Não');	
	       	}else{
	       	win.document.write('Sim');
	       	}
	        win.document.write(' <label for="inputEmail4" class="form-label">Numero Nis: </label>')
	        win.document.write(response.numeronis);                       // O CONTEUDO DA TABELA DENTRO DA TAG BODY
	        win.document.write('</body></html>');
	        win.document.close(); 	                                         // FECHA A JANELA
	        win.print();   
    	  //  $("#modalPesquisar").modal('hide');
    		}
    	}).fail(function(xhr,status,errorThrown){
    		alert("Erro ao buscar usuario por id:" + xhr.responseText);
    	}); 
    	    	                                                         // IMPRIME O CONTEUDO
    }
    
    function mascara(t, mask){
    	 var i = t.value.length;
    	 var saida = mask.substring(1,0);
    	 var texto = mask.substring(i)
    	 if (texto.substring(0,1) != saida){
    	 t.value += texto.substring(0,1);
    	 }
    }
    
    function calculaIdade(){
      	if ($("#datanasc").val() != '') {
		    var dataInput = new Date($("#datanasc").val());
		    if (!isNaN(dataInput)) {
		      var dataAtual = new Date();
		      var diferenca = dataAtual.getFullYear() -
		                      dataInput.getFullYear();
		      $("#idade").val(diferenca);
		      return true;
		    }
		  }
		  $("#idade").val('Data inválida');
		  return false;  
		}
    
    
    function botaoDeletarDaTela(){
    	var codigo= $('#codigo').val();
    	if(codigo!= null && codigo.trim()!=''){
    	deleteCadastro(codigo);
    	}
    	document.getElementById('formCadastro').reset();
    }
    
    function deleteCadastro(codigo){
	
	if(confirm('Deseja realmente deletar?')){
    	
    	$.ajax({
	    		method: "DELETE",
	    		url: "cadastrodelete",
	    		data : "iduser=" + codigo,
	    		success: function(response){
	    			$('#'+codigo).remove();
	    			alert(response);
	    		}
	    	}).fail(function(xhr,status,errorThrown){
	    		alert("Erro ao deletar usuario por id:" + xhr.responseText);
	    	}); 
		}
    }
    
function colocarEmEdicao(codigo){
		
    	$.ajax({
	    		method: "GET",
	    		url: "cadastrobuscaruserId",
	    		data : "iduser=" + codigo,
	    		success: function(response){
	    		$("#codigo").val(response.codigo);
    			$("#nome").val(response.nome);
	   			$("#datanasc").val(response.datanasc);
	   			$("#idade").val(response.idade);
				$("#endereco").val(response.endereco);
				$("#numero").val(response.numero);
				$("#bairro").val(response.bairro);
				$("#cep").val(response.cep);
				$("#cidade").val(response.cidade);
				$("#estado").val(response.estado);
				$("#telefone1").val(response.telefone1);
				$("#telefone2").val(response.telefone2);
				$("#quantosmoram").val(response.quantosmoram);
				$("#numeronis").val(response.numeronis);
	    	  //  $("#modalPesquisar").modal('hide');
	    		}
	    	}).fail(function(xhr,status,errorThrown){
	    		alert("Erro ao buscar usuario por id:" + xhr.responseText);
	    	}); 
    	
    	$('#myTab li:nth-child(2) button').tab('show');

}

    function pesquisarCadastro(){
  	  nome = $('#nomeBusca').val();
  	  
  	  //if(nome != null && nome.trim()!= ''){
  		  
  		  $.ajax({
  	    		method: "GET",
  	    		url: "cadastrobuscarPorNome",
  	    		data : "name=" + nome ,
  	    		success: function(response){
  	    			$('#tabelaresultados > tbody > tr').remove();
  	    			for (var i = 0; i < response.length; i++){
  	   				$('#tabelaresultados > tbody').append('<tr id="'+response[i].codigo+'"><td>'+response[i].codigo+'</td><td>'+response[i].nome+'</td><td>'+response[i].datanasc+'</td><td>'+response[i].idade+'</td><td>'+response[i].endereco+'</td><td>'+response[i].numero+'</td><td>'+response[i].bairro+'</td><td>'+response[i].cep+'</td><td>'+response[i].cidade+'</td><td>'+response[i].telefone1+'</td><td><button type="button" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" role="tab" aria-controls="profile" class="btn btn-secondary" aria-selected="false" onclick="colocarEmEdicao('+response[i].codigo+')">Ver</button></td><td><button type="button" class="btn btn-danger" onclick="deleteCadastro('+response[i].codigo+')">Delete</button></td><td><button type="button" class="btn btn-primary" onclick="CriaPDF('+response[i].codigo+')">Imprimir/PDF</button></td></tr>');
  	    			}
  	    			$('#quantidade').remove();
  	    			$('#registrosencontrados').append('<label id = "quantidade">'+response.length+'</label>');
  	    		}
  	    	}).fail(function(xhr,status,errorThrown){
  	    		alert("Erro ao buscar usuario:" + xhr.responseText);
  	    	}); 
  
  	 // }
    
    }
  function salvarUsuario(){
    	
    	var codigo= $("#codigo").val();
    	var nome = $("#nome").val();
	   	var datanasc = $("#datanasc").val();
	   	var idade = $("#idade").val();
		var endereco = $("#endereco").val();
		var numero = $("#numero").val();
		var bairro = $("#bairro").val();
		var cep = $("#cep").val();
		var cidade = $("#cidade").val();
		var estado = $("#estado").val();
		var telefone1 = $("#telefone1").val();
		var telefone2 = $("#telefone2").val();
		var quantosmoram = $("#quantosmoram").val();
		
		var estuda = "";
         $('input:radio[name=estuda]').each(function() {
             if ($(this).is(':checked'))
                 estuda = $(this).val();
         })
		var numeronis = $("#numeronis").val();
         
        var casapropria ="";
		$('input:radio[name=casapropria]').each(function() {
            if ($(this).is(':checked'))
                casapropria = $(this).val();
        })
	
		
		if(nome == null || nome != null && nome.trim()==''){
    		$("#nome").focus();
    		alert('informe o nome');
    		return;
    	}
    	
    	if(telefone1 == null || telefone1 != null && telefone1.trim()==''){
    		$("#telefone1").focus();
    		alert('informe o telefone');
    		return;
    	}
    	
    	$.ajax({
    		method: "POST",
    		url: "cadastrosalvar",
    		data : JSON.stringify({codigo: codigo, nome : nome, datanasc : datanasc, idade : idade, endereco : endereco, numero : numero, bairro : bairro, cep : cep, cidade : cidade, estado : estado, telefone1 : telefone1, telefone2: telefone2, estuda : estuda, quantosmoram : quantosmoram, casapropria : casapropria, numeronis : numeronis}),
    		contentType: "application/json; charset=utf-8",
    		success: function(response){
    		var resposta = confirm("Você Deseja cadastrar esse registro?");
    			if (resposta == true){
    			$("#codigo").val(response.codigo);
    			alert("Salvo com Sucesso!")
    			}else{
    			alert("Registro Cancelado com Sucesso")
    			}
    		}
    	}).fail(function(xhr,status,errorThrown){
    		alert("Erro ao Salvar:" + xhr.responseText);
    	});
    }
    </script>
</body>
</html>